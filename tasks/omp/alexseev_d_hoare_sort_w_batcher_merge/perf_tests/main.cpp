// Copyright 2024 Alexseev Danila
#include <gtest/gtest.h>
#include <omp.h>

#include <algorithm>
#include <vector>

#include "core/perf/include/perf.hpp"
#include "omp/alexseev_d_hoare_sort_w_batcher_merge/include/hoare_sort_w_batcher_merge_omp.hpp"

using namespace alexseev_omp;

TEST(alexseev_d_hoare_sort_w_batcher_merge_omp, test_pipeline_run) {
  std::vector<int> inputArray = {
      705,  19,   -652, 990,  -207, 601,  967,  -254,  362,   -412, -515, 798,   -206, 342,  650,   255,  -367, -171,
      -871, 170,  -948, -982, -914, -539, 923,  -487,  547,   -669, 533,  97,    384,  -136, -173,  815,  741,  933,
      505,  -830, -514, 485,  645,  929,  673,  -784,  -353,  142,  -155, -597,  -478, -963, 753,   949,  -752, 269,
      790,  824,  -245, -779, -151, -928, 831,  166,   999,   -966, 705,  -410,  -927, 358,  986,   -534, -628, -180,
      36,   145,  316,  -60,  381,  -515, 534,  -83,   -660,  -206, -235, -579,  187,  -477, 893,   -95,  -52,  71,
      -926, -472, -132, -482, -254, 323,  162,  -791,  943,   96,   674,  -865,  27,   33,   534,   796,  456,  -648,
      -169, -61,  704,  918,  559,  262,  349,  426,   395,   88,   972,  156,   -93,  -86,  620,   -232, 373,  -194,
      -419, 886,  -815, -344, 536,  875,  -175, -824,  160,   624,  -635, -349,  -130, 570,  915,   461,  230,  704,
      740,  388,  738,  -714, 604,  553,  -682, 35,    -415,  365,  -662, 347,   650,  -208, -105,  -581, -596, -277,
      -58,  -623, 261,  525,  558,  755,  926,  541,   830,   -325, -809, -876,  413,  -181, 42,    561,  -507, 584,
      -396, 462,  -36,  561,  -726, 252,  149,  47,    506,   251,  490,  187,   -457, 485,  5,     -598, 281,  -730,
      -828, -450, 372,  603,  -101, -810, 809,  695,   815,   -138, 973,  311,   270,  -766, 2,     -647, 724,  -436,
      142,  -848, 242,  -370, 501,  314,  -182, 139,   29,    -843, -578, 872,   -410, -340, 489,   302,  -708, 695,
      934,  462,  140,  725,  31,   330,  -208, -664,  -1000, -185, -207, -528,  -512, -5,   860,   772,  -42,  674,
      -441, 517,  -760, 720,  -129, -968, -919, -745,  722,   702,  -252, -92,   -626, 672,  -248,  -517, -647, 151,
      872,  -156, 125,  39,   -973, 43,   253,  -553,  -275,  94,   -452, -533,  77,   139,  -746,  178,  -522, -353,
      175,  807,  -561, 594,  302,  -130, 695,  248,   753,   20,   537,  -394,  468,  -532, -982,  493,  341,  -33,
      931,  -560, -523, 61,   162,  268,  945,  -270,  -680,  35,   336,  331,   269,  235,  -831,  -402, 537,  100,
      -381, 445,  -706, 362,  870,  864,  -542, 986,   696,   60,   353,  -160,  457,  -702, 206,   574,  545,  53,
      252,  923,  -763, 841,  -72,  -223, -823, 293,   -12,   523,  -506, -411,  18,   -177, -709,  219,  -9,   133,
      -320, 311,  -635, 411,  -159, 755,  937,  -477,  687,   -428, 405,  262,   785,  585,  -991,  -730, 770,  726,
      -979, 451,  810,  611,  -604, -710, -736, -406,  -35,   -112, -696, 504,   117,  -377, 179,   301,  750,  601,
      -650, -99,  -88,  -685, -192, 133,  294,  -666,  33,    392,  679,  720,   -87,  -617, -830,  -934, 838,  67,
      -350, 325,  922,  -503, -805, -522, -519, -661,  -963,  -819, 631,  356,   -292, -464, -940,  199,  -221, -200,
      589,  -925, -496, 505,  -347, 693,  -41,  -553,  316,   92,   -952, 212,   -1,   381,  -411,  1,    232,  -533,
      -598, 151,  173,  29,   460,  334,  -798, -424,  -936,  23,   27,   -593,  -734, 702,  -973,  -336, -896, 432,
      295,  255,  -691, 450,  293,  -395, -332, -794,  -604,  943,  -651, -237,  -974, -349, -798,  -117, 404,  -629,
      -938, 83,   -425, -847, -602, -774, -360, 25,    422,   805,  -814, -855,  109,  -807, 242,   169,  992,  -432,
      314,  -932, 793,  467,  -521, 331,  593,  456,   506,   873,  734,  -565,  -430, -242, -31,   -667, -76,  -81,
      -212, -817, 744,  -901, -417, 58,   -130, 451,   -256,  941,  -943, 654,   -783, 939,  564,   -959, -797, -102,
      -676, 761,  -193, -837, 191,  -444, -12,  239,   465,   690,  357,  306,   177,  59,   398,   276,  -488, -98,
      538,  -565, -197, -962, -256, 179,  559,  535,   87,    553,  755,  796,   -381, -50,  -211,  -727, 3,    97,
      -440, -124, 100,  -800, 69,   775,  675,  -157,  -235,  319,  197,  -389,  -867, -279, 87,    917,  -928, -535,
      -801, 766,  539,  -527, -367, 819,  -292, -245,  743,   -576, -681, 288,   -413, 595,  675,   -214, -118, -980,
      646,  656,  624,  -357, 949,  -295, -165, 916,   504,   -625, -613, -704,  -618, 691,  -568,  -593, -158, -924,
      -490, 601,  -177, -264, -624, 813,  179,  385,   598,   -687, -332, 121,   -805, 313,  -107,  703,  780,  759,
      -967, -231, 552,  -186, 591,  833,  -698, 948,   295,   992,  -447, 879,   985,  45,   723,   -157, 850,  -949,
      918,  -125, 560,  -818, -933, -737, -161, 82,    706,   166,  -429, -714,  212,  -452, -570,  449,  -350, 82,
      372,  259,  185,  -349, -569, 697,  727,  -304,  -224,  834,  232,  -491,  -608, -60,  -759,  664,  721,  -728,
      -847, -19,  -793, 209,  -639, 562,  599,  -602,  -795,  388,  -371, 275,   -743, 544,  778,   947,  938,  322,
      -575, -584, -61,  -523, -122, -986, 285,  631,   -399,  820,  -765, 171,   -722, 890,  36,    575,  -662, 577,
      -827, -465, 26,   -63,  -479, 168,  -534, 682,   720,   3,    110,  -76,   -923, 354,  179,   -812, 505,  -650,
      -915, 621,  975,  -53,  -988, 321,  -430, 903,   102,   449,  617,  363,   896,  -18,  -1000, 842,  526,  875,
      -679, 308,  545,  -433, -575, -16,  394,  -131,  -6,    -164, 117,  -296,  110,  -175, -83,   930,  25,   -22,
      157,  -391, -255, -255, -315, -979, -461, 360,   -706,  684,  -414, -776,  969,  691,  449,   266,  -997, -699,
      -348, -347, -333, 141,  243,  -467, -810, 105,   -330,  -373, 74,   223,   251,  -913, 869,   959,  -524, 509,
      -442, -127, 598,  764,  -562, -829, -257, -322,  364,   -121, 806,  -757,  423,  -874, 193,   128,  -734, 155,
      -459, 192,  883,  -844, 396,  737,  466,  87,    343,   789,  -740, -187,  898,  -810, -143,  -122, -302, -846,
      780,  -426, -846, 801,  -933, -592, -864, -662,  954,   -926, -461, 127,   680,  68,   -81,   736,  -205, -367,
      298,  564,  -508, -649, -430, -628, 13,   983,   978,   524,  883,  793,   -109, -320, 229,   423,  354,  556,
      124,  549,  -257, -29,  858,  165,  -122, -837,  -28,   -774, 896,  -138,  -90,  -191, -835,  -128, -220, -990,
      398,  -795, 95,   -591, -138, -661, -609, -44,   926,   -206, 739,  -898,  253,  786,  257,   -817, 203,  134,
      -939, -556, 944,  118,  -355, 445,  639,  -225,  522,   413,  918,  463,   873,  250,  468,   653,  -752, 301,
      -975, -655, -420, 590,  382,  124,  299,  949,   -974,  -662, 173,  -38,   -780, 96,   -2,    613,  -662, -585,
      -913, -436, 449,  -785, 367,  730,  -85,  -861,  846,   993,  264,  516,   170,  -119, 728,   815,  -975, -408,
      585,  185,  842,  -732, 796,  -443, -958, -895,  291,   369,  -367, 14,    -812, 708,  694,   -669, 826,  -25,
      -505, -771, -646, -378, -650, 838,  448,  -33,   -504,  -595, 455,  831,   -266, -109, 178,   -535, 248,  766,
      185,  -56,  -823, -275, 823,  350,  -665, -926,  -729,  -70,  -841, -321,  867,  -457, -566,  633,  -38,  204,
      -154, -970, 6,    103,  -954, 224,  197,  -410,  -255,  -763, -756, 181,   -873, 371,  681,   -518, 444,  299,
      -325, -395, -471, 926,  -300, -973, 713,  87,    53,    869,  501,  419,   -528, 966,  -644,  734,  -723, 923,
      -537, -883, -714, -935, 635,  -409, 289,  297,   -1000, 483,  -333, 607,   -777, 320,  -713,  -258, -555, -375,
      -42,  -400, -612, 49,   -346, 101,  -588, -877,  -255,  -140, -819, -776,  349,  479,  710,   -97,  647,  894,
      21,   -447, 841,  192,  -793, -380, -581, -999,  62,    40,   -244, 975,   553,  -614, 278,   405,  -323, 211,
      -696, 539,  486,  -255, -594, 699,  137,  -302,  -819,  801,  -227, -702,  796,  -632, -419,  -8,   -657, 282,
      229,  365,  -714, -345, -491, 14,   -944, -362,  -482,  -684, 475,  973,   245,  -405, 987,   917,  -44,  -236,
      665,  -910, -838, -358, 790,  -403, 97,   -527,  -747,  -502, 849,  296,   262,  205,  -516,  598,  386,  202,
      -99,  -792, 486,  -19,  -229, -187, -617, 419,   144,   -452, 346,  -1000, 516,  134,  -48,   -296, -513, -260,
      -216, -342, 180,  -17,  -774, 627,  879,  558,   739,   -473, -258, 91,    -449, -335, -900,  953,  144,  -313,
      720,  578,  -560, 840,  457,  -753, 194,  379,   725,   62,   -683, -645,  623,  -652, 714,   433,  835,  -528,
      867,  413,  -557, -918, -206, 637,  350,  -1000, -240,  654,  783,  -976,  -600, 159,  -377,  -608, -678, 656,
      268,  694,  -319, -561, 491,  709,  312,  992,   -774,  702,  604,  248,   643,  878,  -760,  -497, -344, 554,
      -662, -687, 749,  -498, 291,  683,  -902, -66,   876,   643,  601,  -976,  884,  -560, -396,  735,  -249, -359,
      974,  864,  -307, 110,  -197, -574, -274, -177,  135,   560,  -640, -906,  -233, 778,  698,   561,  509,  536,
      -616, -502, -691, 753,  -584, -966, 940,  284,   -91,   -743, 827,  71,    928,  103,  -660,  664,  646,  234,
      952,  635,  -862, -468, 910,  -307, -863, 506,   717,   147,  -354, -631,  74,   864,  874,   -127, 342,  -227,
      -398, 888,  720,  -35,  -184, 190,  -886, -189,  688,   -247, -975, -839,  690,  -591, 83,    820,  229,  -209,
      -76,  358,  -694, 465,  383,  -545, 392,  634,   312,   791,  -464, -917,  -667, -467, -447,  742,  -458, 435,
      -422, 118,  -636, 373,  905,  677,  13,   511,   840,   617,  -939, 915,   -378, -227, 384,   698,  -243, 399,
      187,  -826, -916, 665,  -967, 324,  -945, -133,  508,   -111, -552, -253,  -738, 12,   562,   471,  117,  649,
      270,  805,  756,  -896, 624,  67,   -996, 387,   26,    309,  -59,  761,   953,  -498, 772,   757,  -564, -658,
      -178, 100,  262,  -58,  -163, -571, 194,  917,   -741,  206,  -310, 670,   -177, -150, 316,   378,  -649, 427,
      171,  -486, 548,  -910, -649, 502,  -648, 713,   -476,  553,  760,  46,    -41,  -863, -725,  -104, 119,  -142,
      -41,  -665, -819, 294,  -40,  -300, 258,  -922,  552,   -740, -687, 635,   89,   37,   411,   358,  -518, 909,
      735,  170,  -457, -950, 604,  298,  174,  359,   -339,  764,  -506, -744,  452,  -507, -670,  -807, 273,  -341,
      997,  -658, 951,  460,  -909, -12,  -914, 168,   -138,  405,  340,  -701,  334,  102,  164,   -129, -739, 136,
      408,  -366, 576,  207,  537,  840,  -660, 550,   -840,  889,  -402, -651,  -248, -398, 784,   -69,  863,  334,
      -130, -686, 81,   597,  588,  876,  -13,  128,   -214,  471,  593,  207,   -556, 881,  -987,  605,  931,  -787,
      -294, -517, -830, 782,  -273, 764,  -916, 385,   -214,  225,  -630, -260,  275,  -923, -549,  222,  -612, 901,
      123,  -419, -948, 623,  428,  -564, 428,  -45,   430,   -411, -483, 218,   562,  -157, 446,   248,  -756, -143,
      782,  962,  -521, -692, 661,  -447, -828, 363,   245,   491,  -697, -778,  691,  -691, 889,   -355, -655, 620,
      906,  695,  388,  203,  -361, 156,  -785, 784,   -727,  749,  944,  255,   310,  730,  435,   -182, 777,  215,
      596,  -118, 22,   442,  -789, -817, 249,  690,   856,   -496, 990,  -459,  -341, -842, 548,   -208, -427, 399,
      838,  576,  -620, 471,  -846, 634,  133,  657,   -432,  111,  -587, 59,    -817, -945, 724,   -781, -541, -443,
      -17,  -443, -433, -913, -497, -671, -408, 840,   952,   981,  809,  36,    437,  814,  1,     446,  16,   287,
      -464, -985, 315,  940,  -799, 308,  -324, 571,   840,   465,  -525, 526,   -11,  -748, 396,   153,  557,  55,
      578,  -99,  -340, -426, -27,  613,  40,   625,   -753,  751,  487,  -560,  -787, 771,  170,   -610, 598,  447,
      -308, -720, 89,   -825, -987, 410,  609,  -195,  -534,  -502, -29,  189,   459,  -839, 498,   257,  -805, 512,
      619,  -779, -375, -460, -688, -203, 21,   -167,  -872,  -386, 460,  193,   -184, 317,  -422,  507,  470,  -369,
      -492, -732, -705, -258, -405, -340, -163, -429,  657,   -513, -719, 447,   78,   372,  833,   574,  564,  304,
      -510, -363, -328, 516,  279,  653,  730,  -53,   -900,  563,  738,  -503,  518,  -754, 465,   -550, -123, -733,
      -407, 612,  -742, -843, 529,  503,  130,  -403,  -670,  -387, 886,  437,   605,  369,  -978,  118,  347,  696,
      483,  -309, -645, -82,  -761, 98,   379,  764,   569,   -792, -616, -591,  151,  -682, 342,   472,  -848, 653,
      959,  -216, 755,  589,  -632, -462, 286,  468,   215,   625,  -883, -293,  691,  -485, 197,   211,  332,  -940,
      510,  614,  575,  -721, 610,  337,  -268, -826,  -825,  -439, -147, -434,  -786, -125, 163,   -250, 789,  -195,
      -981, -44,  888,  302,  482,  -825, 190,  -356,  754,   287,  -182, 459,   904,  609,  728,   -917, 169,  -940,
      686,  -46,  915,  -498, 125,  86,   315,  908,   945,   -999, 470,  106,   -920, 561,  -843,  421,  -54,  -989,
      -689, 876,  -52,  -18,  354,  -450, 287,  86,    189,   -819, 744,  187,   693,  -618, -494,  -100, 443,  -897,
      -620, 856,  -950, -882, -54,  -43,  -428, -743,  745,   -422, 470,  -951,  825,  -443, -405,  692,  -14,  -891,
      600,  -356, -819, -620, 432,  -73,  938,  -743,  689,   887,  -487, -165,  -10,  -2,   758,   218,  -966, -24,
      -655, -765, 7,    389,  574,  253,  -290, 614,   395,   -871, -408, -611,  -827, -231, -824,  -931, 657,  220,
      662,  -30,  -747, 256,  -861, 191,  -330, -505,  48,    44,   536,  -924,  -28,  -236, 437,   378,  -35,  546,
      795,  -5326};
  ;

  // Sequential
  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortWBatcherMergeSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortWBatcherMergeSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortWBatcherMergeSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortWBatcherMergeSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortWBatcherMergeSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortWBatcherMergeSequential hoareSortWBatcherMergeSequential(hoareSortWBatcherMergeSeq);
  ASSERT_TRUE(hoareSortWBatcherMergeSequential.validation());
  hoareSortWBatcherMergeSequential.pre_processing();
  hoareSortWBatcherMergeSequential.run();
  hoareSortWBatcherMergeSequential.post_processing();

  // OMP
  std::vector<int> outputArrayOMP(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortWBatcherMergeOMP = std::make_shared<ppc::core::TaskData>();
  hoareSortWBatcherMergeOMP->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortWBatcherMergeOMP->inputs_count.emplace_back(inputArray.size());
  hoareSortWBatcherMergeOMP->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayOMP.data()));
  hoareSortWBatcherMergeOMP->outputs_count.emplace_back(inputArray.size());

  auto hoareSortWBatcherMergeOMPParallel = std::make_shared<HoareSortWBatcherMergeOMP>(hoareSortWBatcherMergeOMP);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  perfAttr->current_timer = [&] { return omp_get_wtime(); };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortWBatcherMergeOMPParallel);
  perfAnalyzer->pipeline_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayOMP);
}

TEST(alexseev_d_hoare_sort_w_batcher_merge_omp, test_task_run) {
  std::vector<int> inputArray = {
      705,  19,   -652, 990,  -207, 601,  967,  -254,  362,   -412, -515, 798,   -206, 342,  650,   255,  -367, -171,
      -871, 170,  -948, -982, -914, -539, 923,  -487,  547,   -669, 533,  97,    384,  -136, -173,  815,  741,  933,
      505,  -830, -514, 485,  645,  929,  673,  -784,  -353,  142,  -155, -597,  -478, -963, 753,   949,  -752, 269,
      790,  824,  -245, -779, -151, -928, 831,  166,   999,   -966, 705,  -410,  -927, 358,  986,   -534, -628, -180,
      36,   145,  316,  -60,  381,  -515, 534,  -83,   -660,  -206, -235, -579,  187,  -477, 893,   -95,  -52,  71,
      -926, -472, -132, -482, -254, 323,  162,  -791,  943,   96,   674,  -865,  27,   33,   534,   796,  456,  -648,
      -169, -61,  704,  918,  559,  262,  349,  426,   395,   88,   972,  156,   -93,  -86,  620,   -232, 373,  -194,
      -419, 886,  -815, -344, 536,  875,  -175, -824,  160,   624,  -635, -349,  -130, 570,  915,   461,  230,  704,
      740,  388,  738,  -714, 604,  553,  -682, 35,    -415,  365,  -662, 347,   650,  -208, -105,  -581, -596, -277,
      -58,  -623, 261,  525,  558,  755,  926,  541,   830,   -325, -809, -876,  413,  -181, 42,    561,  -507, 584,
      -396, 462,  -36,  561,  -726, 252,  149,  47,    506,   251,  490,  187,   -457, 485,  5,     -598, 281,  -730,
      -828, -450, 372,  603,  -101, -810, 809,  695,   815,   -138, 973,  311,   270,  -766, 2,     -647, 724,  -436,
      142,  -848, 242,  -370, 501,  314,  -182, 139,   29,    -843, -578, 872,   -410, -340, 489,   302,  -708, 695,
      934,  462,  140,  725,  31,   330,  -208, -664,  -1000, -185, -207, -528,  -512, -5,   860,   772,  -42,  674,
      -441, 517,  -760, 720,  -129, -968, -919, -745,  722,   702,  -252, -92,   -626, 672,  -248,  -517, -647, 151,
      872,  -156, 125,  39,   -973, 43,   253,  -553,  -275,  94,   -452, -533,  77,   139,  -746,  178,  -522, -353,
      175,  807,  -561, 594,  302,  -130, 695,  248,   753,   20,   537,  -394,  468,  -532, -982,  493,  341,  -33,
      931,  -560, -523, 61,   162,  268,  945,  -270,  -680,  35,   336,  331,   269,  235,  -831,  -402, 537,  100,
      -381, 445,  -706, 362,  870,  864,  -542, 986,   696,   60,   353,  -160,  457,  -702, 206,   574,  545,  53,
      252,  923,  -763, 841,  -72,  -223, -823, 293,   -12,   523,  -506, -411,  18,   -177, -709,  219,  -9,   133,
      -320, 311,  -635, 411,  -159, 755,  937,  -477,  687,   -428, 405,  262,   785,  585,  -991,  -730, 770,  726,
      -979, 451,  810,  611,  -604, -710, -736, -406,  -35,   -112, -696, 504,   117,  -377, 179,   301,  750,  601,
      -650, -99,  -88,  -685, -192, 133,  294,  -666,  33,    392,  679,  720,   -87,  -617, -830,  -934, 838,  67,
      -350, 325,  922,  -503, -805, -522, -519, -661,  -963,  -819, 631,  356,   -292, -464, -940,  199,  -221, -200,
      589,  -925, -496, 505,  -347, 693,  -41,  -553,  316,   92,   -952, 212,   -1,   381,  -411,  1,    232,  -533,
      -598, 151,  173,  29,   460,  334,  -798, -424,  -936,  23,   27,   -593,  -734, 702,  -973,  -336, -896, 432,
      295,  255,  -691, 450,  293,  -395, -332, -794,  -604,  943,  -651, -237,  -974, -349, -798,  -117, 404,  -629,
      -938, 83,   -425, -847, -602, -774, -360, 25,    422,   805,  -814, -855,  109,  -807, 242,   169,  992,  -432,
      314,  -932, 793,  467,  -521, 331,  593,  456,   506,   873,  734,  -565,  -430, -242, -31,   -667, -76,  -81,
      -212, -817, 744,  -901, -417, 58,   -130, 451,   -256,  941,  -943, 654,   -783, 939,  564,   -959, -797, -102,
      -676, 761,  -193, -837, 191,  -444, -12,  239,   465,   690,  357,  306,   177,  59,   398,   276,  -488, -98,
      538,  -565, -197, -962, -256, 179,  559,  535,   87,    553,  755,  796,   -381, -50,  -211,  -727, 3,    97,
      -440, -124, 100,  -800, 69,   775,  675,  -157,  -235,  319,  197,  -389,  -867, -279, 87,    917,  -928, -535,
      -801, 766,  539,  -527, -367, 819,  -292, -245,  743,   -576, -681, 288,   -413, 595,  675,   -214, -118, -980,
      646,  656,  624,  -357, 949,  -295, -165, 916,   504,   -625, -613, -704,  -618, 691,  -568,  -593, -158, -924,
      -490, 601,  -177, -264, -624, 813,  179,  385,   598,   -687, -332, 121,   -805, 313,  -107,  703,  780,  759,
      -967, -231, 552,  -186, 591,  833,  -698, 948,   295,   992,  -447, 879,   985,  45,   723,   -157, 850,  -949,
      918,  -125, 560,  -818, -933, -737, -161, 82,    706,   166,  -429, -714,  212,  -452, -570,  449,  -350, 82,
      372,  259,  185,  -349, -569, 697,  727,  -304,  -224,  834,  232,  -491,  -608, -60,  -759,  664,  721,  -728,
      -847, -19,  -793, 209,  -639, 562,  599,  -602,  -795,  388,  -371, 275,   -743, 544,  778,   947,  938,  322,
      -575, -584, -61,  -523, -122, -986, 285,  631,   -399,  820,  -765, 171,   -722, 890,  36,    575,  -662, 577,
      -827, -465, 26,   -63,  -479, 168,  -534, 682,   720,   3,    110,  -76,   -923, 354,  179,   -812, 505,  -650,
      -915, 621,  975,  -53,  -988, 321,  -430, 903,   102,   449,  617,  363,   896,  -18,  -1000, 842,  526,  875,
      -679, 308,  545,  -433, -575, -16,  394,  -131,  -6,    -164, 117,  -296,  110,  -175, -83,   930,  25,   -22,
      157,  -391, -255, -255, -315, -979, -461, 360,   -706,  684,  -414, -776,  969,  691,  449,   266,  -997, -699,
      -348, -347, -333, 141,  243,  -467, -810, 105,   -330,  -373, 74,   223,   251,  -913, 869,   959,  -524, 509,
      -442, -127, 598,  764,  -562, -829, -257, -322,  364,   -121, 806,  -757,  423,  -874, 193,   128,  -734, 155,
      -459, 192,  883,  -844, 396,  737,  466,  87,    343,   789,  -740, -187,  898,  -810, -143,  -122, -302, -846,
      780,  -426, -846, 801,  -933, -592, -864, -662,  954,   -926, -461, 127,   680,  68,   -81,   736,  -205, -367,
      298,  564,  -508, -649, -430, -628, 13,   983,   978,   524,  883,  793,   -109, -320, 229,   423,  354,  556,
      124,  549,  -257, -29,  858,  165,  -122, -837,  -28,   -774, 896,  -138,  -90,  -191, -835,  -128, -220, -990,
      398,  -795, 95,   -591, -138, -661, -609, -44,   926,   -206, 739,  -898,  253,  786,  257,   -817, 203,  134,
      -939, -556, 944,  118,  -355, 445,  639,  -225,  522,   413,  918,  463,   873,  250,  468,   653,  -752, 301,
      -975, -655, -420, 590,  382,  124,  299,  949,   -974,  -662, 173,  -38,   -780, 96,   -2,    613,  -662, -585,
      -913, -436, 449,  -785, 367,  730,  -85,  -861,  846,   993,  264,  516,   170,  -119, 728,   815,  -975, -408,
      585,  185,  842,  -732, 796,  -443, -958, -895,  291,   369,  -367, 14,    -812, 708,  694,   -669, 826,  -25,
      -505, -771, -646, -378, -650, 838,  448,  -33,   -504,  -595, 455,  831,   -266, -109, 178,   -535, 248,  766,
      185,  -56,  -823, -275, 823,  350,  -665, -926,  -729,  -70,  -841, -321,  867,  -457, -566,  633,  -38,  204,
      -154, -970, 6,    103,  -954, 224,  197,  -410,  -255,  -763, -756, 181,   -873, 371,  681,   -518, 444,  299,
      -325, -395, -471, 926,  -300, -973, 713,  87,    53,    869,  501,  419,   -528, 966,  -644,  734,  -723, 923,
      -537, -883, -714, -935, 635,  -409, 289,  297,   -1000, 483,  -333, 607,   -777, 320,  -713,  -258, -555, -375,
      -42,  -400, -612, 49,   -346, 101,  -588, -877,  -255,  -140, -819, -776,  349,  479,  710,   -97,  647,  894,
      21,   -447, 841,  192,  -793, -380, -581, -999,  62,    40,   -244, 975,   553,  -614, 278,   405,  -323, 211,
      -696, 539,  486,  -255, -594, 699,  137,  -302,  -819,  801,  -227, -702,  796,  -632, -419,  -8,   -657, 282,
      229,  365,  -714, -345, -491, 14,   -944, -362,  -482,  -684, 475,  973,   245,  -405, 987,   917,  -44,  -236,
      665,  -910, -838, -358, 790,  -403, 97,   -527,  -747,  -502, 849,  296,   262,  205,  -516,  598,  386,  202,
      -99,  -792, 486,  -19,  -229, -187, -617, 419,   144,   -452, 346,  -1000, 516,  134,  -48,   -296, -513, -260,
      -216, -342, 180,  -17,  -774, 627,  879,  558,   739,   -473, -258, 91,    -449, -335, -900,  953,  144,  -313,
      720,  578,  -560, 840,  457,  -753, 194,  379,   725,   62,   -683, -645,  623,  -652, 714,   433,  835,  -528,
      867,  413,  -557, -918, -206, 637,  350,  -1000, -240,  654,  783,  -976,  -600, 159,  -377,  -608, -678, 656,
      268,  694,  -319, -561, 491,  709,  312,  992,   -774,  702,  604,  248,   643,  878,  -760,  -497, -344, 554,
      -662, -687, 749,  -498, 291,  683,  -902, -66,   876,   643,  601,  -976,  884,  -560, -396,  735,  -249, -359,
      974,  864,  -307, 110,  -197, -574, -274, -177,  135,   560,  -640, -906,  -233, 778,  698,   561,  509,  536,
      -616, -502, -691, 753,  -584, -966, 940,  284,   -91,   -743, 827,  71,    928,  103,  -660,  664,  646,  234,
      952,  635,  -862, -468, 910,  -307, -863, 506,   717,   147,  -354, -631,  74,   864,  874,   -127, 342,  -227,
      -398, 888,  720,  -35,  -184, 190,  -886, -189,  688,   -247, -975, -839,  690,  -591, 83,    820,  229,  -209,
      -76,  358,  -694, 465,  383,  -545, 392,  634,   312,   791,  -464, -917,  -667, -467, -447,  742,  -458, 435,
      -422, 118,  -636, 373,  905,  677,  13,   511,   840,   617,  -939, 915,   -378, -227, 384,   698,  -243, 399,
      187,  -826, -916, 665,  -967, 324,  -945, -133,  508,   -111, -552, -253,  -738, 12,   562,   471,  117,  649,
      270,  805,  756,  -896, 624,  67,   -996, 387,   26,    309,  -59,  761,   953,  -498, 772,   757,  -564, -658,
      -178, 100,  262,  -58,  -163, -571, 194,  917,   -741,  206,  -310, 670,   -177, -150, 316,   378,  -649, 427,
      171,  -486, 548,  -910, -649, 502,  -648, 713,   -476,  553,  760,  46,    -41,  -863, -725,  -104, 119,  -142,
      -41,  -665, -819, 294,  -40,  -300, 258,  -922,  552,   -740, -687, 635,   89,   37,   411,   358,  -518, 909,
      735,  170,  -457, -950, 604,  298,  174,  359,   -339,  764,  -506, -744,  452,  -507, -670,  -807, 273,  -341,
      997,  -658, 951,  460,  -909, -12,  -914, 168,   -138,  405,  340,  -701,  334,  102,  164,   -129, -739, 136,
      408,  -366, 576,  207,  537,  840,  -660, 550,   -840,  889,  -402, -651,  -248, -398, 784,   -69,  863,  334,
      -130, -686, 81,   597,  588,  876,  -13,  128,   -214,  471,  593,  207,   -556, 881,  -987,  605,  931,  -787,
      -294, -517, -830, 782,  -273, 764,  -916, 385,   -214,  225,  -630, -260,  275,  -923, -549,  222,  -612, 901,
      123,  -419, -948, 623,  428,  -564, 428,  -45,   430,   -411, -483, 218,   562,  -157, 446,   248,  -756, -143,
      782,  962,  -521, -692, 661,  -447, -828, 363,   245,   491,  -697, -778,  691,  -691, 889,   -355, -655, 620,
      906,  695,  388,  203,  -361, 156,  -785, 784,   -727,  749,  944,  255,   310,  730,  435,   -182, 777,  215,
      596,  -118, 22,   442,  -789, -817, 249,  690,   856,   -496, 990,  -459,  -341, -842, 548,   -208, -427, 399,
      838,  576,  -620, 471,  -846, 634,  133,  657,   -432,  111,  -587, 59,    -817, -945, 724,   -781, -541, -443,
      -17,  -443, -433, -913, -497, -671, -408, 840,   952,   981,  809,  36,    437,  814,  1,     446,  16,   287,
      -464, -985, 315,  940,  -799, 308,  -324, 571,   840,   465,  -525, 526,   -11,  -748, 396,   153,  557,  55,
      578,  -99,  -340, -426, -27,  613,  40,   625,   -753,  751,  487,  -560,  -787, 771,  170,   -610, 598,  447,
      -308, -720, 89,   -825, -987, 410,  609,  -195,  -534,  -502, -29,  189,   459,  -839, 498,   257,  -805, 512,
      619,  -779, -375, -460, -688, -203, 21,   -167,  -872,  -386, 460,  193,   -184, 317,  -422,  507,  470,  -369,
      -492, -732, -705, -258, -405, -340, -163, -429,  657,   -513, -719, 447,   78,   372,  833,   574,  564,  304,
      -510, -363, -328, 516,  279,  653,  730,  -53,   -900,  563,  738,  -503,  518,  -754, 465,   -550, -123, -733,
      -407, 612,  -742, -843, 529,  503,  130,  -403,  -670,  -387, 886,  437,   605,  369,  -978,  118,  347,  696,
      483,  -309, -645, -82,  -761, 98,   379,  764,   569,   -792, -616, -591,  151,  -682, 342,   472,  -848, 653,
      959,  -216, 755,  589,  -632, -462, 286,  468,   215,   625,  -883, -293,  691,  -485, 197,   211,  332,  -940,
      510,  614,  575,  -721, 610,  337,  -268, -826,  -825,  -439, -147, -434,  -786, -125, 163,   -250, 789,  -195,
      -981, -44,  888,  302,  482,  -825, 190,  -356,  754,   287,  -182, 459,   904,  609,  728,   -917, 169,  -940,
      686,  -46,  915,  -498, 125,  86,   315,  908,   945,   -999, 470,  106,   -920, 561,  -843,  421,  -54,  -989,
      -689, 876,  -52,  -18,  354,  -450, 287,  86,    189,   -819, 744,  187,   693,  -618, -494,  -100, 443,  -897,
      -620, 856,  -950, -882, -54,  -43,  -428, -743,  745,   -422, 470,  -951,  825,  -443, -405,  692,  -14,  -891,
      600,  -356, -819, -620, 432,  -73,  938,  -743,  689,   887,  -487, -165,  -10,  -2,   758,   218,  -966, -24,
      -655, -765, 7,    389,  574,  253,  -290, 614,   395,   -871, -408, -611,  -827, -231, -824,  -931, 657,  220,
      662,  -30,  -747, 256,  -861, 191,  -330, -505,  48,    44,   536,  -924,  -28,  -236, 437,   378,  -35,  546,
      795,  -5326};

  // Sequential
  std::vector<int> outputArraySeq(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortWBatcherMergeSeq = std::make_shared<ppc::core::TaskData>();
  hoareSortWBatcherMergeSeq->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortWBatcherMergeSeq->inputs_count.emplace_back(inputArray.size());
  hoareSortWBatcherMergeSeq->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArraySeq.data()));
  hoareSortWBatcherMergeSeq->outputs_count.emplace_back(inputArray.size());

  HoareSortWBatcherMergeSequential hoareSortWBatcherMergeSequential(hoareSortWBatcherMergeSeq);
  ASSERT_TRUE(hoareSortWBatcherMergeSequential.validation());
  hoareSortWBatcherMergeSequential.pre_processing();
  hoareSortWBatcherMergeSequential.run();
  hoareSortWBatcherMergeSequential.post_processing();

  // OMP
  std::vector<int> outputArrayOMP(inputArray.size());

  std::shared_ptr<ppc::core::TaskData> hoareSortWBatcherMergeOMP = std::make_shared<ppc::core::TaskData>();
  hoareSortWBatcherMergeOMP->inputs.emplace_back(reinterpret_cast<uint8_t *>(inputArray.data()));
  hoareSortWBatcherMergeOMP->inputs_count.emplace_back(inputArray.size());
  hoareSortWBatcherMergeOMP->outputs.emplace_back(reinterpret_cast<uint8_t *>(outputArrayOMP.data()));
  hoareSortWBatcherMergeOMP->outputs_count.emplace_back(inputArray.size());

  auto hoareSortWBatcherMergeOMPParallel = std::make_shared<HoareSortWBatcherMergeOMP>(hoareSortWBatcherMergeOMP);

  auto perfAttr = std::make_shared<ppc::core::PerfAttr>();
  perfAttr->num_running = 10;
  perfAttr->current_timer = [&] { return omp_get_wtime(); };

  auto perfResults = std::make_shared<ppc::core::PerfResults>();

  auto perfAnalyzer = std::make_shared<ppc::core::Perf>(hoareSortWBatcherMergeOMPParallel);
  perfAnalyzer->task_run(perfAttr, perfResults);
  ppc::core::Perf::print_perf_statistic(perfResults);
  ASSERT_EQ(outputArraySeq, outputArrayOMP);
}
